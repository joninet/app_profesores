<nav class="sidebar">
    <div class="d-flex align-items-center mb-3">
        <i class="fas fa-graduation-cap fa-lg me-2"></i>
        <h4 class="m-0">EduAdmin</h4>
    </div>
  
    <div class="sidebar-content">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="{% url 'home' %}">
                    <i class="fas fa-home me-2"></i> Inicio
                </a>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'colegio' %}">
                  <i class="fas fa-chalkboard-teacher me-2"></i> Colegios
              </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'materia' %}">
                    <i class="fas fa-book me-2"></i> Materias
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'curso' %}">
                    <i class="fas fa-graduation-cap me-2"></i> Cursos
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="collapse" href="#materiasSubmenu">
                    <i class="fas fa-book me-2"></i> Materias
                    <i class="fas fa-chevron-down float-end"></i>
                </a>
                <div class="collapse" id="materiasSubmenu">
                    <ul class="nav flex-column ms-3">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'materia_crear' %}">
                                <i class="fas fa-plus-circle me-2"></i> Agregar
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <i class="fas fa-edit me-2"></i> Editar
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
  
    <!-- Sección de logout -->
    <div class="user-profile">
        <div class="d-flex align-items-center mb-2">
            <i class="fas fa-user-circle user-icon me-2"></i>
            <div>
                <small class="m-0 fw-bold">Usuario</small>
                <p class="m-0 small">{{ user.username }}</p>
                <small class="m-0 fw-bold">Año Lectivo</small>
                <div class="d-flex align-items-center">
                    <p class="m-0 small me-2">{{ ano_lectivo.ano }}</p>
                    <i class="fas fa-sync-alt text-primary" style="font-size: 0.7rem;" title="Cambiar Año Lectivo" id="cambiarAnoLectivoIcon"></i>
                </div>
            </div>
        </div>
        <a href="/logout" class="btn btn-sm login-btn">
          <i class="fas fa-sign-out-alt me-1"></i>
          Cerrar Sesion
        </a>
        {% else %}
        <a href="/signin" class="btn btn-sm login-btn">
          <i class="fas fa-sign-out-alt me-1"></i>
          Iniciar Sesión
        </a>  
        {% endif %}    
    </div>
  </nav>
  <div class="modal fade" id="cambiarAnoLectivoModal" tabindex="-1" aria-labelledby="cambiarAnoLectivoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cambiarAnoLectivoModalLabel">Cambiar Año Lectivo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="cambiarAnoLectivoForm" method="POST" action="{% url 'cambiar_ano_lectivo' %}">
                    {% csrf_token %}
                    <select name="ano_lectivo_id" id="anoLectivoSelect" class="form-select">
                        {% for ano in anos_lectivos %}
                            <option value="{{ ano.id }}" {% if ano.id == ano_lectivo.id %}selected{% endif %}>{{ ano.ano }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary btn-sm mt-2">Cambiar Año Lectivo</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('cambiarAnoLectivoIcon').addEventListener('click', function() {
    var modal = new bootstrap.Modal(document.getElementById('cambiarAnoLectivoModal'));
    modal.show();
});

document.getElementById('cambiarAnoLectivoForm').addEventListener('submit', function(event) {
    event.preventDefault();
    var form = event.target;
    var formData = new FormData(form);
    fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': formData.get('csrfmiddlewaretoken')
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert(data.error);
        }
    });
});
</script>